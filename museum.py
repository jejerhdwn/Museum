# -*- coding: utf-8 -*-
"""Museum.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1eq3Md5Rn6Y9uAPGSl5zZ-n8-ycr-99dC
"""

import streamlit as st
import requests
import pandas as pd

# ğŸŒ ê¸°ë³¸ ì„¤ì •
st.set_page_config(page_title="Museum Artworks (The Met)", page_icon="ğŸ–¼ï¸", layout="centered")

st.title("ğŸ–¼ï¸ The Metropolitan Museum of Art - Open Collection")
st.caption("ë¬´ë£Œ, API í‚¤ ì—†ì´ ì‘ë™í•˜ëŠ” ë¯¸ìˆ ê´€ ì‘í’ˆ ì˜¤í”ˆë°ì´í„° API")

# ğŸ”¹ ê²€ìƒ‰ì–´ ì…ë ¥
query = st.text_input("ê²€ìƒ‰í•  ì‘í’ˆ í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: van Gogh, Egypt, portrait ë“±)", "van Gogh")

# ğŸ”¹ ê²€ìƒ‰ ë²„íŠ¼
if st.button("ì‘í’ˆ ë¶ˆëŸ¬ì˜¤ê¸°"):
    # 1ï¸âƒ£ ì‘í’ˆ ID ê²€ìƒ‰ (ê²€ìƒ‰ì–´ ê¸°ë°˜)
    search_url = f"https://collectionapi.metmuseum.org/public/collection/v1/search?q={query}&hasImages=true"
    search_response = requests.get(search_url)

    if search_response.status_code == 200:
        search_data = search_response.json()
        object_ids = search_data.get("objectIDs", [])

        if not object_ids:
            st.warning("ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ë‹¤ë¥¸ í‚¤ì›Œë“œë¥¼ ì…ë ¥í•´ë³´ì„¸ìš”.")
        else:
            st.success(f"âœ… {len(object_ids)}ê°œì˜ ì‘í’ˆì´ ê²€ìƒ‰ë˜ì—ˆìŠµë‹ˆë‹¤. (ìµœëŒ€ 10ê°œë§Œ í‘œì‹œ)")

            # 2ï¸âƒ£ ìƒìœ„ 10ê°œ ì‘í’ˆë§Œ ìƒì„¸ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸°
            object_ids = object_ids[:10]
            artworks = []
            for obj_id in object_ids:
                obj_url = f"https://collectionapi.metmuseum.org/public/collection/v1/objects/{obj_id}"
                obj_res = requests.get(obj_url)
                if obj_res.status_code == 200:
                    artworks.append(obj_res.json())

            # 3ï¸âƒ£ DataFrameìœ¼ë¡œ ì •ë¦¬
            df = pd.DataFrame([
                {
                    "ì‘í’ˆëª…": art.get("title", "N/A"),
                    "ì‘ê°€": art.get("artistDisplayName", "Unknown"),
                    "ì œì‘ì—°ë„": art.get("objectDate", "N/A"),
                    "ë¬¸í™”ê¶Œ": art.get("culture", "N/A"),
                    "ì´ë¯¸ì§€": art.get("primaryImageSmall", None)
                }
                for art in artworks
            ])

            # í‘œë¡œ í‘œì‹œ
            st.dataframe(df[["ì‘í’ˆëª…", "ì‘ê°€", "ì œì‘ì—°ë„", "ë¬¸í™”ê¶Œ"]])

            # ì´ë¯¸ì§€ í‘œì‹œ
            st.subheader("ğŸ¨ ì‘í’ˆ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°")
            for _, row in df.iterrows():
                if row["ì´ë¯¸ì§€"]:
                    st.image(row["ì´ë¯¸ì§€"], caption=f"{row['ì‘í’ˆëª…']} â€” {row['ì‘ê°€']}")
                else:
                    st.text(f"{row['ì‘í’ˆëª…']} â€” (ì´ë¯¸ì§€ ì—†ìŒ)")
    else:
        st.error(f"âŒ ìš”ì²­ ì‹¤íŒ¨: {search_response.status_code}")